import React, { useState } from "react";
import web3logo from "../../assets/images/web3logo.svg";
import mailIcon from "../../assets/images/mailIcon.svg";
import keyIcon from "../../assets/images/keyIcon.svg";
import eyeIcon from "../../assets/images/eyeIcon.svg";
import eyeSlashIcon from "../../assets/images/eyeSlashIcon.svg";
import { Link, useNavigate } from "react-router-dom";
import { handleError, postApiCall, setCookie } from "../../Utils/Utils.js";
import "react-toastify/dist/ReactToastify.css";
import { toast, ToastContainer } from "react-toastify";
import { getDefaultNormalizer } from "@testing-library/react";
import RouterList from "../../Routes/RouterList";
const LoginPage = () => {
  const [value, setValue] = useState({
    email: "",
    password: "",
  });
  const [isDisadble, setIsDisable] = useState(false);
  const [emailError, setEmailError] = useState(false);
  const [validEmailError, setValidEmailError] = useState(false);
  const [passwordError, setPasswordError] = useState(false);
  const [validPasswordError, setValidPasswordError] = useState(false);
  const navigate=useNavigate();
  const [eyeImage, setEyeImage] = useState(false);
  const validateEmail = "^[a-zA-Z0-9._:$!%-]+@[a-zA-Z0-9.-]+.[a-zA-Z]$";
  const validatePassword =
    "^(?=.*?[A-Za-z])(?=.*?[0-9]).{6,}$";
  const [showPassword,setShowPassword]=useState(false);

  const handleOnChange = (e) => {
    setValue({ ...value, [e.target.name]: e.target.value });
  };
  const handleSubmit = () => {
    if (!value?.email) {
      setEmailError(true);
    } else if (!(value?.email).match(validateEmail)) {
      setValidEmailError(true);
    } else if (!value?.password) {
      setPasswordError(true);
    } else if (!(value?.password).match(validatePassword)) {
      setValidPasswordError(true);
    }
    else{
      const data ={
        email:value?.email,
        password:value?.password
      }
      postApiCall("merchant/login", data, (response) => {
        console.log("login",response);
        if (response.success) {
          console.log(response)
          toast.success(response.message);
          setCookie("AuthWeb3Merchant", response?.data?.authorization);
          window.location.reload();
        } else {
          toast.error(handleError(response));
          setIsDisable(false);
        }
      });
     }
  };
  const handleShowPassword = () => {
    setShowPassword(!showPassword);
  };
  return (
    <div>
      <div className="s_outer">
        <div className="s_inner">
          <div className="s_logo">
            <img src={web3logo}/>
          </div>
          <div className="s_login">
            <div className="s_loginContent">
              <div className="s_welcome">
                <h1>Hey, hello!!</h1>
                <p>Enter your credentials to access your account</p>
              </div>
              <form className="s_loginForm">
                <label className="s_label">Email</label>
                <div className="s_mail">
                  <input
                    className="s_emailInput"
                    type="email"
                    placeholder="Enter your email"
                    name="email"
                    value={value.email}
                    id="email"
                    onChange={handleOnChange}
                  ></input>
                  <img className="s_messageIcon" src={mailIcon}/>
                  {emailError && value.email === "" ? (
                    <label className="s_alertmessage">
                      Please Enter Your Email
                    </label>
                  ) : (
                    ""
                  )}
                  {validEmailError &&
                  !value.email.match(validateEmail) &&
                  value.email !== "" ? (
                    <label className="s_alertmessage">
                      Please Enter Valid Email
                    </label>
                  ) : (
                    ""
                  )}
                </div>

                <label className="s_label">Password</label>
                <div className="s_password">
                  <input
                    className="s_passwordInput"
                    type={showPassword?"text":"password"}
                    placeholder="Enter password"
                    name="password"
                    value={value.password}
                    onChange={handleOnChange}
                  ></input>
                  <img className="s_passkey" src={keyIcon}/>
                  <div onClick={handleShowPassword}>
                    {showPassword === false ? (
                      <img
                        className="s_eyeIcon"
                        src={eyeSlashIcon}
                        alt="eyeslashicon"
                      />
                    ) : (
                      <img className="s_eyeIcon" src={eyeIcon} alt="eyeicon"/>
                    )}
                  </div>

                  {passwordError && value.password === "" ? (
                    <label className="s_alertmessage">
                      Please Enter Password
                    </label>
                  ) : (
                    ""
                  )}
                  {(validPasswordError &&
                  !value.password.match(validatePassword)) &&
                  value.password !== "" ? (
                    <label className="s_alertmessage">
                      Please Enter Valid Password
                    </label>
                  ) : (
                    ""
                  )}
                </div>
              </form>

              <div className="s_forgotPassword">
                <Link to={"/forgotpassword"} className="s_link">
                  Forgot Password?
                </Link>
              </div>
              <div>
                  <button onClick={handleSubmit} className="s_submit">
                    Submit
                  </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <ToastContainer/>
    </div>
  );
};

export default LoginPage;
